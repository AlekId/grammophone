<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Functional</title>
    <link rel="stylesheet" href="../views.css">
    <style>
      
      article {
        margin: 1em 0;
      }
      
    </style>
  </head>
  <body>
    
    <ul>
      <li><a href="#sanity">sanity</a></li>
      <li><a href="#vitals">vitals</a></li>
      <li><a href="#ll1">ll1</a></li>
      <li><a href="#lr0">lr0</a></li>
      <li><a href="#slr1">slr1</a></li>
      <li><a href="#lr1">lr1</a></li>
      <li><a href="#lalr1">lalr1</a></li>
    </ul>
    
    <section id="results">
    </section>
    
    <script src="../lib/zepto.js"></script>
    <script src="grammars.js"></script>
    <script src="functional.js"></script>
    <script src="../src/relation.js"></script>
    <script src="../src/set.js"></script>
    <script src="../src/parser.js"></script>
    <script src="../src/grammar.js"></script>
    <script src="../src/calculations.js"></script>
    <script src="../src/calculations/grammar.js"></script>
    <script src="../src/calculations/parsing.js"></script>
    <script src="../src/calculations/parsing/ll.js"></script>
    <script src="../src/calculations/parsing/lr.js"></script>
    <script src="../src/helpers.js"></script>
    <script src="../src/views.js"></script>
    <script src="../src/views/productions.js"></script>
    <script src="../src/views/sanity.js"></script>
    <script src="../src/views/nullable.js"></script>
    <script src="../src/views/first.js"></script>
    <script src="../src/views/follow.js"></script>
    <script src="../src/views/endable.js"></script>
    <script src="../src/views/ll1_table.js"></script>
    <script src="../src/views/lr_automaton.js"></script>
    <script src="../src/views/lr0_table.js"></script>
    <script src="../src/views/lr1_table.js"></script>
    <script>
      
      // Instantiate test grammars
      
      var grammars = TEST_GRAMMARS.map(function(g) {
        return {
          name: g.name,
          grammar: new Grammar(g.productions.map(function(p) { return p.split(/\s+/) }))
        };
      });
      
      // 
      
      function loadTestCase(name) {
        
        if (typeof tests[name] === "undefined") {
          $("#results").html("<p>The test <i>" + name + "</i> is not defined.</p>");
          return;
        }
        
        $("#results").html("");
        
        grammars.forEach(function(g) {
          
          // make parameters
        
          var params = {};
          var k;
        
          for (k in tests[name].params)
            params[k] = tests[name].params[k];
        
          for (k in tests[name].calculations)
            params[k] = g.grammar.calculate(tests[name].calculations[k]);
          
          // dispay view
          
          $("#results").append("<h1>" + g.name + "</h1>");
          
          var productions = new Views["productions"]();
          productions.update({
            productions: g.grammar.calculate("grammar.productions"),
            info: g.grammar.calculate("grammar.symbol_info"),
          });
          $("#results").append(productions.element);
          
          tests[name].views.forEach(function(v) {
            
            if (typeof Views[v] === "undefined")
              throw "Undefined view " + v;
          
            var view = new Views[v]();
            view.update(params);
            $("#results").append(view.element);
            
          });
          
        });
        
      }
      
      function loadHash() {
        
        var hash = window.location.hash;
        
        if (hash.length <= 1)
          $("#results").html("");
        else
          loadTestCase(hash.slice(1));
        
      }
      
      window.addEventListener("load", function() {
        loadHash();
      });
      
      window.addEventListener("hashchange", function() {
        loadHash();
      });
      
    </script>
    
  </body>
</html>