<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Performance</title>
    <style>
      
      p {
        background: #eee;
      }
      
    </style>
  </head>
  <body>
    
    <section id="results">
    </section>
    
    <script src="/assets/application.js"></script>
    <script src="./large_grammars.js"></script>
    <script>
      
      var queue = [];
      
      LARGE_GRAMMARS.forEach(function(info) {
        queue.unshift({ info: info, calculation: "parsing.lr.lr0_table" });
        queue.unshift({ info: info, calculation: "parsing.lr.lr1_table" });
        queue.unshift({ info: info, calculation: "parsing.lr.lalr1_table" });
      });
      
      var para;
      
      function dispatch() {
        var task = queue.pop();
        
        if (task) {
          para = $("<p>Calculating <b>" + task.calculation + "</b> for <b>" + task.info.name + "</b>&hellip;</p>");
          $("#results").append(para);
          
          worker.postMessage({ spec: task.info.spec, calculation: task.calculation });
        }
      }
      
      function done(data) {
        para.append(" Done. Elapsed time: <b>" + (data.elapsed / 1000) + "s</b>");
        console.log(data.result);
        dispatch();
      }
      
      var worker = new Worker("./performance_worker.js");
      
      worker.addEventListener("message", function(event) {
        done(event.data);
      });
      
      dispatch();
      
    </script>
    
  </body>
</html>
